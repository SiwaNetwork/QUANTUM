# Доступ к удаленному порту GNSS TTY

Драйвер таймерной карты (ptp_ocp) предоставляет прямой доступ к модулю GNSS через порт TTY в системе Linux. К сожалению, U-Blox предоставляет свое программное обеспечение u-center только для Windows. В результате нет прямого способа отслеживать или перенастраивать модуль "на лету".

Для активации управления через u-center можно использовать пакет ser2net для предоставления доступа к порту TTY через Ethernet. Это руководство опишет основные шаги для активации этого случая использования и настройки роверной конфигурации на модуле ZED-F9T.

# Установка и настройка ser2net

Пакет ser2net доступен в большинстве дистрибутивов через стандартные пакеты. Для дистрибутивов на основе Red Hat выполните следующую команду:

sudo dnf install ser2net

Для дистрибутивов на основе Debian:

sudo apt-get install ser2net

Это установит пакет ser2net и создаст необходимые конфигурационные файлы.

## Поиск порта TTY для GNSS

Для поиска порта, связанного с портом GNSS, выполните:


dmesg | grep ocp
```

> [    4.627215] ptp_ocp 0000:02:00.0: enabling device (0100 -> 0102)
> [    4.628143] ptp_ocp 0000:02:00.0: irq 16 out of range, skipping ts4
> [    4.631062] ptp_ocp 0000:02:00.0: Version 1.2.0, clock PPS, device ptp0
> [    4.631078] ptp_ocp 0000:02:00.0: Time: 1659170219.993081800, UNSYNCED
> [    4.631081] ptp_ocp 0000:02:00.0: version 8
> [    4.631083] ptp_ocp 0000:02:00.0: regular image, version 8
> [    4.631084] ptp_ocp 0000:02:00.0:  GNSS: /dev/ttyS5  @ 115200
> [    4.631087] ptp_ocp 0000:02:00.0: GNSS2: /dev/ttyS6  @ 115200
> [    4.631089] ptp_ocp 0000:02:00.0:   MAC: /dev/ttyS7  @  57600
> [    4.631094] ptp_ocp 0000:02:00.0:  NMEA: /dev/ttyS8  @     -1
> ```

Или альтернативно,

ls -ls /sys/class/timecard/ocp*/ttyGNSS
```

> ```
> 0 lrwxrwxrwx. 1 root root 0 Jul 30 11:07 /sys/class/timecard/ocp0/ttyGNSS -> ../../tty/ttyS5


В обоих случаях `/dev/ttyS5` - это наше устройство. Теперь мы можем предоставить к нему доступ через Ethernet.

## Настройка ser2net

Теперь нам нужно отредактировать конфигурационный файл и предоставить доступ к последовательному порту GNSS Time Card. Конфигурационный файл по умолчанию для ser2net пытается по умолчанию предоставить доступ к множеству портов, поэтому мы его резервируем и создаем новый файл только с портом, который мы пытаемся предоставить.

sudo mv /etc/ser2net.conf /etc/ser2net.conf.bak
sudo sh -c "echo -e 2006:raw:5:/dev/ttyS5:115200 > /etc/ser2net.conf"

Теперь мы можем запустить ser2net

ser2net

И открыть порт в брандмауэре

sudo firewall-cmd --add-port=2006/tcp


Теперь мы можем подключиться к модулю GNSS напрямую, используя функцию сетевого подключения u-center.

## Сетевое подключение через u-center

Для удаленного доступа к GNSS используйте встроенную функцию сетевого подключения в u-center. Выберите опцию New... и введите адрес удаленной платформы: `tcp://192.168.1.20:2006`

<img src="C:\_src_\Time-Appliance-Project\Time-Card\GNSS\UBX\RCB-F9T\remote_access_GNSS.png" style="zoom:100%;" />

U-center должен подключиться к удаленному модулю и позволить вам его настраивать, читать статус модуля и использовать функцию RTK ровера.