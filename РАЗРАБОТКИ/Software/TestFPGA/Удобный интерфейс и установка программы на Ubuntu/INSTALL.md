# Инструкция по установке и использованию TestApp GUI

## Содержание

1. [Системные требования](#системные-требования)
2. [Установка из deb-пакета](#установка-из-deb-пакета)
3. [Ручная установка из исходников](#ручная-установка-из-исходников)
4. [Запуск программы](#запуск-программы)
5. [Использование программы](#использование-программы)
6. [Устранение неполадок](#устранение-неполадок)

## Системные требования

Для работы TestApp GUI требуется:

- Операционная система Ubuntu 18.04 или новее
- Права root для доступа к /dev/mem
- Библиотека GTK+ 3
- PolicyKit для запуска с повышенными привилегиями

Минимальные требования к оборудованию:
- Процессор: 1 ГГц или быстрее
- Оперативная память: 512 МБ
- Свободное место на диске: 10 МБ
- Устройство FPGA, подключенное через PCIe

## Установка из deb-пакета

Установка из deb-пакета является наиболее простым и рекомендуемым способом установки TestApp GUI.

### Шаг 1: Скачайте deb-пакет

Скачайте файл `testapp-gui_1.0.0_amd64.deb` из репозитория проекта или из предоставленного архива.

### Шаг 2: Установите пакет

Откройте терминал и перейдите в каталог, где находится скачанный файл:

```bash
cd /путь/к/каталогу/с/пакетом
```

Установите пакет с помощью команды:

```bash
sudo dpkg -i testapp-gui_1.0.0_amd64.deb
```

### Шаг 3: Установите зависимости (при необходимости)

Если при установке возникли проблемы с зависимостями, выполните следующую команду для их автоматической установки:

```bash
sudo apt-get install -f
```

После успешной установки программа будет доступна в меню приложений в разделе "Системные" или через команду `testapp_gui` в терминале.

## Ручная установка из исходников

Если вы предпочитаете установку из исходных кодов или хотите внести изменения в программу, следуйте инструкциям ниже.

### Шаг 1: Распакуйте архив с исходными кодами

```bash
tar -xzf testapp-gui-src.tar.gz
cd TestAppGUI
```

или

```bash
unzip testapp-gui-src.zip
cd TestAppGUI
```

### Шаг 2: Установите необходимые зависимости

```bash
sudo ./install_dependencies.sh
```

Этот скрипт установит все необходимые пакеты для сборки и запуска программы:
- gcc
- make
- pkg-config
- libgtk-3-dev
- policykit-1

### Шаг 3: Скомпилируйте программу

```bash
./build.sh
```

Этот скрипт выполнит компиляцию программы с помощью make. После успешной компиляции в текущем каталоге будет создан исполняемый файл `testapp_gui`.

### Шаг 4: (Опционально) Установите программу в систему

Если вы хотите установить программу в систему для доступа из меню приложений и через команду `testapp_gui`, выполните:

```bash
sudo ./install.sh
```

Этот скрипт скопирует исполняемый файл в `/usr/bin/`, установит .desktop файл, иконку и файл политики PolicyKit.

## Запуск программы

### Запуск после установки из deb-пакета или через install.sh

После установки программы в систему вы можете запустить её одним из следующих способов:

1. Через меню приложений:
   - Откройте меню приложений Ubuntu
   - Найдите "TestApp GUI" в разделе "Системные" или через поиск
   - Щелкните по иконке программы

2. Через терминал:
   ```bash
   testapp_gui
   ```

При запуске программы вам будет предложено ввести пароль администратора, так как для доступа к /dev/mem требуются права root.

### Запуск без установки в систему

Если вы не устанавливали программу в систему, вы можете запустить её из каталога с исходными кодами:

```bash
cd /путь/к/TestAppGUI
./run.sh
```

Скрипт `run.sh` автоматически запустит программу с необходимыми правами через pkexec.

## Использование программы

### Подключение к FPGA

1. Запустите программу TestApp GUI
2. В поле "Базовый адрес PCIe" введите адрес в формате `0xA0000000`
3. Нажмите кнопку "Подключиться"

После успешного подключения в левой части окна будут отображены версии различных IP-ядер FPGA, а в правой части - текущий статус часов, источник тактирования, состояние GPIO и ширина импульса PPS.

### Мониторинг в реальном времени

1. После подключения к FPGA нажмите кнопку "Запустить мониторинг"
2. Программа начнет автоматически обновлять данные каждую секунду
3. Для остановки мониторинга нажмите кнопку "Остановить мониторинг"

### Индикаторы GPIO

В правой части окна отображаются индикаторы состояния GPIO:
- Зеленый индикатор означает, что соответствующий бит установлен (1)
- Красный индикатор означает, что соответствующий бит сброшен (0)

### Отключение от FPGA

Для отключения от FPGA нажмите кнопку "Отключиться". Программа освободит ресурсы и будет готова к новому подключению.

## Устранение неполадок

### Ошибка "Не удалось открыть /dev/mem"

Эта ошибка возникает, если программа запущена без прав root. Убедитесь, что вы запускаете программу через pkexec или sudo.

### Ошибка "Не удалось отобразить память FPGA"

Возможные причины:
1. Неверный базовый адрес PCIe
2. FPGA не подключена или не настроена
3. Проблемы с драйверами PCIe

Решение:
- Проверьте правильность введенного адреса
- Убедитесь, что FPGA правильно подключена и настроена
- Проверьте наличие необходимых драйверов

### Программа не запускается из меню приложений

Если программа установлена, но не запускается из меню приложений:

1. Проверьте наличие файла `/usr/share/applications/testapp_gui.desktop`
2. Проверьте наличие файла `/usr/share/polkit-1/actions/org.testapp.gui.policy`
3. Убедитесь, что исполняемый файл `/usr/bin/testapp_gui` существует и имеет права на выполнение

Если что-то из перечисленного отсутствует, переустановите программу:

```bash
sudo dpkg -i testapp-gui_1.0.0_amd64.deb
```

или

```bash
cd /путь/к/TestAppGUI
sudo ./install.sh
```

### Другие проблемы

Если у вас возникли другие проблемы с программой, обратитесь к документации или создайте issue в репозитории проекта с подробным описанием проблемы.

